<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>키워드로 장소검색하기</title>

</head>
<body>
<div id="map" style="width:100%;height:350px;"></div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7f09f9655a4bd5b71df1d29c598929c6&libraries=services"></script>
<script>

  var options = {
    enableHighAccuracy: true,
    timeout: 5000,
    maximumAge: 0
  };

  function success(pos) {
    var crd = pos.coords;

    console.log('Your current position is:');
    console.log('Latitude : ' + crd.latitude);
    console.log('Longitude: ' + crd.longitude);
    console.log('More or less ' + crd.accuracy + ' meters.');
  };

  function error(err) {
    console.warn('ERROR(' + err.code + '): ' + err.message);
  };

  const cp = navigator.geolocation.getCurrentPosition(success, error, options);

  function getCurrentPosition() {
    return new Promise(function (resolve, reject) {
      navigator.geolocation.getCurrentPosition(resolve, reject)
    })
  }

  getCurrentPosition()
  .then(cp => createMap(cp))

  // getCurrentPosition(curPos)
  // .then(position => {
  //   createMap(position)
  // });

  function createMap(cp) {
    var lat = cp.coords.latitude,
        lon = cp.coords.longitude;
    var locPosition = new kakao.maps.LatLng(lat, lon); // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
    message = '<div style="padding:5px;">현위치</div>'; // 인포윈도우에 표시될 내용입니다

  // 마커와 인포윈도우를 표시합니다
    displayMarker(locPosition, message);

  // 마커를 클릭하면 장소명을 표출할 인포윈도우 입니다
    var infowindow = new kakao.maps.InfoWindow({zIndex:1});

    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
          center: new kakao.maps.LatLng(lat, lon), // 지도의 중심좌표
          level: 3 // 지도의 확대 레벨
        };

    // 지도를 생성합니다
    var map = new kakao.maps.Map(mapContainer, mapOption);

  // 장소 검색 객체를 생성합니다
    var ps = new kakao.maps.services.Places();

  // 키워드로 장소를 검색합니다
    ps.keywordSearch('헬스장', placesSearchCB, {
      radius : 2000,
      location: new kakao.maps.LatLng(lat, lon)
    });

  // 키워드 검색 완료 시 호출되는 콜백함수 입니다
  function placesSearchCB (data, status, pagination) {
    if (status === kakao.maps.services.Status.OK) {

      // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
      // LatLngBounds 객체에 좌표를 추가합니다
      var bounds = new kakao.maps.LatLngBounds();

      for (var i=0; i<data.length; i++) {
        displayMarker(data[i]);
        bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
      }

      // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
      map.setBounds(bounds);
    }
  }

  // 지도에 마커를 표시하는 함수입니다
    function displayMarker(place) {

      // 마커를 생성하고 지도에 표시합니다
      var marker = new kakao.maps.Marker({
        map: map,
        position: new kakao.maps.LatLng(place.y, place.x)
      });

      // 마커에 클릭이벤트를 등록합니다
      kakao.maps.event.addListener(marker, 'click', function () {
        // 마커를 클릭하면 장소명이 인포윈도우에 표출됩니다
        infowindow.setContent(
            '<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>');
        infowindow.open(map, marker);
      });
    }
  }

</script>
</body>
</html>

<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <meta http-equiv="X-UA-Compatible" content="IE=edge">-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">-->
<!--  <title>간단한 지도 표시하기</title>-->
<!--  <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=zi6w8887xq"></script>-->
<!--</head>-->
<!--<body>-->
<!--<div id="map" style="width:100%;height:600px;"></div>-->

<!--<script>-->
<!--  var options = {-->
<!--    enableHighAccuracy: true,-->
<!--    timeout: 5000,-->
<!--    maximumAge: 0-->
<!--  };-->

<!--  function success(pos) {-->
<!--    var crd = pos.coords;-->
<!--  };-->

<!--  function error(err) {-->
<!--    console.warn('ERROR(' + err.code + '): ' + err.message);-->
<!--  };-->

<!--  // 동기화를 위해 적용, 비동기일 시 지도가 먼저 나오고 현재 위치가 반영됨.-->
<!--  function getCurrentPosition() {-->
<!--    return new Promise(function (resolve, reject) {-->
<!--      navigator.geolocation.getCurrentPosition(resolve, reject)-->
<!--    });-->
<!--  };-->

<!--  function createMap(point) {-->
<!--    var mapOptions = {-->
<!--      center: new naver.maps.LatLng(point.coords.latitude, point.coords.longitude),-->
<!--      zoom: 12-->
<!--    };-->
<!--    console.log(point.coords)-->
<!--    return new naver.maps.Map('map', mapOptions);-->
<!--  }-->

<!--  getCurrentPosition().then(point => createMap(point))-->

<!--</script>-->
<!--</body>-->
<!--</html>-->

<!--var infowindow = new naver.maps.InfoWindow();-->

<!--function onSuccessGeolocation(position) { //실행할 함수-->
<!--var location = new naver.maps.LatLng(position.coords.latitude,-->
<!--position.coords.longitude);-->

<!--map.setCenter(location); // 지도의 중심을 어디로 잡을것인지 설정하는 코드-->
<!--map.setZoom(15); // 지도가 얼만큼 줌 되어있는지 설정하는 코드-->

<!--infowindow.setContent('<div style="padding:20px;">' + 'geolocation.getCurrentPosition() 위치' + '</div>');-->
<!--// 마커에 안내해줄 문구-->
<!--infowindow.open(map, location);-->
<!--console.log('Coordinates: ' + location.toString());-->
<!--}-->

<!--function onErrorGeolocation() { // 오류 시 발생될 예외처리용 함수-->
<!--var center = map.getCenter();-->

<!--infowindow.setContent('<div style="padding:20px;">' +-->
<!--  '<h5 style="margin-bottom:5px;color:#f00;">Geolocation failed!</h5>'+ "latitude: "+ center.lat() +"<br />longitude: "+ center.lng() +'</div>');-->

<!--infowindow.open(map, center);-->
<!--}-->

<!--$(window).on("load", function() { // 창이 실행되면 현 위치 값 구하는 함수 실행되는 제이쿼리-->
<!--if (navigator.geolocation) {-->

<!--navigator.geolocation.getCurrentPosition(onSuccessGeolocation, onErrorGeolocation);-->
<!--} else {-->
<!--var center = map.getCenter();-->
<!--infowindow.setContent('<div style="padding:20px;"><h5 style="margin-bottom:5px;color:#f00;">Geolocation not supported</h5></div>');-->
<!--infowindow.open(map, center);-->
<!--}-->
<!--});-->